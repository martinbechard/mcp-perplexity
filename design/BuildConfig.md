<!--
Copyright (c) 2024 Martin Bechard <martin.bechard@DevConsult.ca>
This software is licensed under the MIT License.
File: /Users/martinbechard/dev/mcp-perplexity/design/BuildConfig.md
This was generated by Claude Sonnet 3.5, with the assistance of my human mentor

Design document capturing the build and package configuration characteristics
Build: Making it work is half the battle, making it build is the other half!
-->

# Build Configuration Design

## Package Characteristics
1. Package Identity
   - Name: Uses @modelcontextprotocol scope to align with MCP ecosystem
   - Type: ESM modules required for compatibility with modern Node.js features and MCP SDK
   - Main Entry: Uses dist/index.js to expose library interface
   - Types Entry: Parallel dist/index.d.ts required for TypeScript consumers

2. Executable Characteristics
   - Binary Name: Follows standard mcp-server-{provider} naming convention
   - Entry Point: stdio-server.js implements stdio-based protocol interface
   - Execution Mode: Script needs execute permission for direct invocation

3. Core Dependencies
   - MCP SDK: Required for protocol implementation
   - HTTP Client: Axios chosen for its TypeScript support and reliability
   - Validation: Zod for runtime type checking of API responses
   - Environment: Dotenv for configuration management

4. Development Support
   - Testing: Jest ecosystem chosen for TypeScript integration
   - Build Clean: Rimraf ensures cross-platform directory cleanup
   - Types: Node and Jest definitions required for TypeScript development

## TypeScript Configuration

1. ECMAScript Target
   - ES2022: Required for async code and modern syntax
   - NodeNext: Matches ESM module system requirements
   - Module Resolution: NodeNext enables ESM import/export syntax
   - Directory Structure: src to dist follows TypeScript conventions

2. Type System Setup
   - Strict Mode: Disabled to accommodate MCP SDK types
   - Type Definitions: Generated for library consumers
   - Source Maps: Required for debugging and testing
   - Core Types: Node and Jest provide platform definitions

3. Build Controls
   - Case Sensitivity: Required for cross-platform compatibility
   - Skip Lib Check: Optimizes build by avoiding dependency checks
   - ESM Interop: Required for mixed ESM/CommonJS environment
   - Include/Exclude: Standard TypeScript project organization

## Build Process Design

1. Standard Build
   - Clean step prevents stale artifacts
   - TypeScript compilation produces distributable code
   - Output immediately runnable

2. Debug Build
   - Adds source maps for debugging support
   - Sets executable bit for direct script running
   - Preserves TypeScript-to-JavaScript mapping

3. Test Integration
   - Jest configured for TypeScript
   - TypeScript paths mapped for test imports
   - Source maps enabled for debugging

## Architecture Implications

1. Runtime Requirements
   - ES2022 features dictate Node.js version requirements
   - ESM modules affect import/require behavior
   - Modern Node.js required for protocol features

2. Development Pattern
   - Editor must support TypeScript/source maps
   - Build clean required between compilations
   - Test workflow integrated with TypeScript

3. Deployment Model
   - Packaged as npm module for distribution
   - Provides executable command-line interface
   - Self-contained with explicit dependencies

4. Testing Architecture
   - Jest handles TypeScript and ESM
   - Source maps enable test debugging
   - Node.js typings ensure API coverage

5. Code Structure
   - Source isolation in src directory
   - Clean output separation in dist
   - Type definitions for external use